<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>B03 – Recuperar contraseña</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">

  <!-- NAVBAR SIMPLE -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container">
      <a class="navbar-brand" href="index.html">El Mariachi</a>
      <div class="ms-auto">
        <a id="authLink" class="nav-link" href="B02login.html">Iniciar sesión</a>
      </div>
    </div>
  </nav>

  <!-- CONTENIDO -->
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-6 col-lg-5">
        <div class="card shadow-sm">
          <div class="card-body">
            <h3 class="card-title mb-3">Recuperar contraseña</h3>
            <p class="text-muted small">
              Ingresa el correo con el que te registraste. 
              Te enviaremos un mensaje con instrucciones (simulado).
            </p>

            <form id="recoverForm" novalidate>
              <div class="mb-3">
                <label for="recEmail" class="form-label">Correo electrónico</label>
                <input type="email" class="form-control" id="recEmail" required>
              </div>

              <button type="submit" class="btn btn-primary w-100">
                Enviar enlace de recuperación
              </button>
            </form>

            <div id="recoverMsg" class="small mt-3"></div>

            <div class="mt-3 text-center">
              <a href="B02login.html" class="small">Volver al inicio de sesión</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- app.js común -->
  <script src="./assets/app.js"></script>

  <!-- Lógica específica de recuperación -->
  <script>
    const recoverForm = document.getElementById('recoverForm');
    const recoverMsg  = document.getElementById('recoverMsg');

    if (recoverForm) {
      recoverForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = document.getElementById('recEmail').value.trim().toLowerCase();
        if (!email) {
          recoverMsg.textContent = 'Por favor ingresa tu correo.';
          recoverMsg.className = 'small mt-3 text-danger';
          return;
        }

        recoverMsg.textContent = 'Procesando solicitud…';
        recoverMsg.className = 'small mt-3 text-muted';

        try {
          const res = await fetch(`${API_USUARIOS}/recuperar`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
          });

          const data = await res.json().catch(() => ({}));

          if (!res.ok || data.ok === false) {
            recoverMsg.textContent = data.msg || 'No pudimos procesar la recuperación.';
            recoverMsg.className = 'small mt-3 text-danger';
            return;
          }

          // Mensaje “bonito” simulando envío de correo
          recoverMsg.innerHTML = `
            <span class="text-success fw-semibold">Solicitud recibida ✅</span><br>
            Si el correo <strong>${email}</strong> está registrado,
            hemos enviado un mensaje con instrucciones (simulado).
          `;
          recoverMsg.className = 'small mt-3';

        } catch (err) {
          console.error('Error en recuperación:', err);
          recoverMsg.textContent = 'Error de red al contactar la API.';
          recoverMsg.className = 'small mt-3 text-danger';
        }
      });
    }
  </script>
</body>
</html>
