<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>B06 ‚Äì Detalle de producto</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    .price-big { font-size: 1.6rem; font-weight: 700; }
    .strike { text-decoration: line-through; opacity: 0.7; margin-right: .5rem; }
  </style>
</head>
<body class="bg-light">

<div class="container py-4">

  <!-- F1: Gherkin -->
  <div class="mb-3">
    <h5><strong>Escenarios (Gherkin):</strong></h5>
    <ul class="mb-0">
      <li><b>Detalle:</b> Dado que el cliente selecciona un producto, cuando abre el detalle, entonces ve imagen, descripci√≥n, precio y stock.</li>
      <li><b>Sin stock:</b> Dado un producto con stock = 0, cuando se abre el detalle, entonces se muestra ‚ÄúProducto no disponible‚Äù y se desactiva ‚ÄúAgregar‚Äù.</li>
      <li><b>Promoci√≥n:</b> Dado que el producto tiene promoci√≥n activa, cuando se abre el detalle, entonces se ve precio original tachado, precio promo y etiqueta.</li>
    </ul>
  </div>

  <!-- F2/F3/F4: Vista detalle + Sin stock + Promoci√≥n -->
  <div id="detalle"></div>

  <!-- F5: Clase Producto -->
  <div class="mt-4">
    <h6>Clase <code>Producto</code> (mock):</h6>
<pre class="bg-white p-3 border rounded"><code>Producto {
  idProducto: Integer
  nombre: String
  descripcion: String
  categoria: String
  precio: Float
  stock: Integer
  imagen: String
  promocionActiva: Boolean
  etiquetaDescuento: String   // ej: "-20%"
  precioPromo: Float          // precio con descuento
}</code></pre>
  </div>
</div>

<script>
  // === Datos de ejemplo (mant√©n ids consistentes con B05) ===
  const PRODUCTOS = [
    {
      idProducto: 1,
      nombre: 'Tacos al Pastor',
      descripcion: 'Tortillas suaves con carne marinada, pi√±a y cebolla.',
      categoria: 'tacos',
      precio: 4990,
      stock: 10,
      imagen: 'assets/ImagenesMariachi/tacos1.jpg',
      promocionActiva: false,
      etiquetaDescuento: '',
      precioPromo: null
    },
    {
      idProducto: 2,
      nombre: 'Tacos Supremos',
      descripcion: 'Doble porci√≥n y toppings extra para los antojados.',
      categoria: 'tacos',
      precio: 5990,
      stock: 8,
      imagen: 'assets/ImagenesMariachi/tacos3.jpg',
      promocionActiva: true,
      etiquetaDescuento: '-15%',
      precioPromo: 5090
    },
    {
      idProducto: 3,
      nombre: 'Burrito Especial',
      descripcion: 'Relleno de carne, frijoles, arroz y guacamole fresco.',
      categoria: 'burritos',
      precio: 6490,
      stock: 12,
      imagen: 'assets/ImagenesMariachi/burrito1.jpg',
      promocionActiva: true,
      etiquetaDescuento: '-20%',
      precioPromo: 5190
    },
    {
      idProducto: 4,
      nombre: 'Combo Fiesta',
      descripcion: 'Incluye tacos, burrito y bebida. Ideal para compartir.',
      categoria: 'combos',
      precio: 10990,
      stock: 0, // SIN STOCK
      imagen: 'assets/ImagenesMariachi/combo4.jpeg',
      promocionActiva: false,
      etiquetaDescuento: '',
      precioPromo: null
    },
    {
      idProducto: 5,
      nombre: 'Combo Familiar',
      descripcion: 'Pack familiar con burritos, tacos y bebidas.',
      categoria: 'combos',
      precio: 12990,
      stock: 5,
      imagen: 'assets/ImagenesMariachi/combo5.jpeg',
      promocionActiva: false,
      etiquetaDescuento: '',
      precioPromo: null
    }
  ];

  // === Leer ?id= de la URL ===
  const sp = new URLSearchParams(location.search);
  const id = parseInt(sp.get('id') || '', 10);

  const prod = PRODUCTOS.find(p => p.idProducto === id);
  const root = document.getElementById('detalle');

  if (!prod) {
    root.innerHTML = `
      <div class="alert alert-danger">
        Producto no encontrado. 
        <a href="javascript:history.back()">Volver</a>
      </div>`;
  } else {
    const sinStock = prod.stock <= 0;
    const enPromo = !!prod.promocionActiva && prod.precioPromo && prod.precioPromo > 0;

    root.innerHTML = `
      <div class="row g-4 align-items-start">
        <div class="col-md-5 text-center">
          <img src="${prod.imagen}" class="img-fluid rounded shadow" alt="${prod.nombre}">
        </div>
        <div class="col-md-7">
          <div class="d-flex align-items-center gap-2 mb-2">
            <h2 class="mb-0">${prod.nombre}</h2>
            <span class="badge bg-secondary text-uppercase">${prod.categoria}</span>
            ${enPromo ? `<span class="badge bg-danger">${prod.etiquetaDescuento || 'Promo'}</span>` : ''}
          </div>

          <p class="text-muted">${prod.descripcion}</p>

          <div class="mb-3">
            ${enPromo
              ? `<span class="strike">$${prod.precio}</span>
                 <span class="price-big text-danger">$${prod.precioPromo}</span>`
              : `<span class="price-big text-success">$${prod.precio}</span>`
            }
          </div>

          <p class="mb-3">
            <strong>Stock:</strong> 
            ${sinStock ? '<span class="text-danger">No disponible</span>' : `${prod.stock} unidad(es)`}
          </p>

          <div class="d-flex gap-2">
            <button class="btn btn-success" ${sinStock ? 'disabled' : ''}>
              Agregar al carrito
            </button>
            <a class="btn btn-outline-secondary" href="javascript:history.back()">Volver</a>
          </div>

          ${sinStock ? `
            <div class="alert alert-warning mt-3" role="alert">
              üö´ Producto no disponible por el momento.
            </div>` : ''
          }
        </div>
      </div>
    `;
  }
</script>

</body>
</html>
